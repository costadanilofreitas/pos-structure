<?xml version="1.0" encoding="UTF-8"?>
<!--
	Module Name: sapiensprocs.xml
	Module Description: Sapiens procedures
-->
<Procedures>
	<Procedure name="sapiens_create_line">
		INSERT OR REPLACE INTO sapiens.SapiensData (Type, CreatedDate, SentDate, Data, Uploaded, filialSapiens, BusinessDate)
			SELECT CAST(:Type as varchar), CAST(:CreatedDate as varchar), CAST(:SentDate as varchar), CAST(:Data as blob), CAST(:Uploaded AS integer), CAST(:filialSapiens as varchar), CAST(:BusinessDate as varchar);
	</Procedure>
    <Procedure name="sapiens_update_data">
		UPDATE sapiens.SapiensData
		SET Data = :Data
		WHERE Id = :Id
    </Procedure>
	<Procedure name="sapiens_set_files_sent">
		UPDATE sapiens.SapiensData
		SET Uploaded = 1, SentDate = :SentDate
		WHERE Id = :Id
	</Procedure>    
    <Procedure name="sapiens_get_data_by_sent_date">
        SELECT Data
		FROM SapiensData
		WHERE SentDate BETWEEN :fromDate AND :toDate
            AND Type = :Type
    </Procedure>
    <Procedure name="sapiens_get_all_files_by_created_date">
        SELECT Data
		FROM SapiensData
		WHERE CreatedDate BETWEEN :fromCreatedDate AND :toCreatedDate
    </Procedure>
    <Procedure name="sapiens_get_all_files_by_sent_date">
        SELECT Id, Type, CreatedDate, SentDate, Data, Uploaded, filialSapiens, BusinessDate
		FROM SapiensData
		WHERE SentDate BETWEEN :fromSentDate AND :toSentDate
    </Procedure>
    <Procedure name="sapiens_get_rows_by_business_date">
        SELECT Id, Type, CreatedDate, SentDate, Data, Uploaded, filialSapiens, BusinessDate
		FROM SapiensData
		WHERE BusinessDate BETWEEN :fromDate AND :toDate and filialSapiens = :filialSapiens ORDER BY BusinessDate
    </Procedure>
    <Procedure name="sapiens_get_all_nonsent_files">
        SELECT Id, Type, Data, filialSapiens, BusinessDate
		FROM SapiensData
		WHERE Uploaded = 0
    </Procedure>
	<Procedure name="sapiens_delete_row">
		DELETE FROM sapiens.SapiensData
        WHERE CAST(:Id AS integer) == Id AND CAST(:BusinessDate as varchar) == BusinessDate
	</Procedure>
	<Procedure name="sapiens_backup_create_line">
		INSERT INTO sapiens_bkp.SapiensDataBkp (Type, CreatedDate, SentDate, Data, Uploaded, filialSapiens, BusinessDate)
			SELECT CAST(:Type as varchar), CAST(:CreatedDate as varchar), CAST(:SentDate as varchar), CAST(:Data as blob), CAST(:Uploaded AS integer), CAST(:filialSapiens as varchar), CAST(:BusinessDate as varchar);
	</Procedure>
</Procedures>
